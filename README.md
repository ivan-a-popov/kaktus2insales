1. Описание интеграции Кактус - InSales для интернет-магазина. 
1.1 Общая задача: постоянное обновление остатков в InSales на основании данных в системе Кактус (kak2c.ru).
1.2 Метод решения: периодическое получение остстаков по API Кактус и обновление остатков по API InSales. Частота обновления - максимально приближенная к реальному времени.

2. Особенности интеграции. 
2.1 API-авторизация на сервисе kak2c.ru выполняется по сложной схеме: https://wiki.kak2c.ru/books/kaktus-dlya-razrabotchikov/chapter/авторизация
При первоначальной авторизации по логину и паролю выдаётся временный токен, который следует использовать для дальнейших запросов:
https://wiki.kak2c.ru/books/kaktus-dlya-razrabotchikov/page/apiliteauth
2.1.2 Для получения токена нужно отправить POST-запрос со следующим содержимым в raw-формате:
{
"login":"wow55@mail.ru",
"password":"wow"
}
(Именно это составляет содержимое файла files/kak2c_info.)
2.1.3 В настоящее время срок действия токена ограничен 14400 секундами. По истечении срока действия сервер начинает возвращать ответ следующего формата:
{"errors":[{"code":401,"message":"JWT expired at 2021-12-30T21:10:02Z. Current time: 2022-01-02T10:59:24Z, a difference of 222562896 milliseconds.  Allowed clock skew: 0 milliseconds."}],"success":false}

2.2 Все товары имеют варианты (один товар - много размеров), остатки по вариантам могут быть разные. Нужно передавать остаток по каждому варианту отдельно. 
2.2.1 В InSales используется стандартная структура: товар с вариантами.
2.2.2 В kak2c наряду со стандартной структурой (1 товар со множеством вариантов) может встречаться нестандартная схема (1 вариант = 1 товар). 
2.2.3 Сопоставление товаров производится по штрихкоду. Предполагается, что каждый вариант имеет уникальный штрихкод, при этом штрихкоды одинаковы в обеих системах. 
2.2.4 В интеграции участвуют только те варианты, для которых в InSales установлен уникальный штрихкод. Если штрихкод не установлен, обновление не происходит. Подразумевается, что должна гарантироваться уникальность штрихкода (нельзя допускать, чтобы у разных вариантов был один и тот же штрихкод, т.к. это может привести к некорректному обновлению).

3. Алгоритм работы интеграции.
3.1 Скрипт запускается по расписанию (раз в минуту) и получает все товары из InSales запросом /admin/products.json
3.2 Проходим по всем товарам и вариантам. Извлекаем варианты, для которых задан штрихкод, и записываем их в словарь вида {"штрихкод": внутренний ID InSales}.
3.3 Получаем все товары из Кактус запросом https://app.kak2c.ru/api/lite/products
3.4 Проходим по всем товарам и вариантам, записываем их в словарь вида {"штрихкод": количество}.
3.5 Итерируем по первому словарю, если находим ключ во втором, то добавляем вариант в запрос на обновление остатков в InSales.
3.6 Обновляем остатки запросом /admin/products/variants_group_update.json
